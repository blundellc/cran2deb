#!/usr/bin/rc

mkdir -p warn fail
shift
if ([ ! -e all_pkgs ]) {
    cran2deb cran_pkgs $* >all_pkgs
}
for (pkg in `{cat all_pkgs}) {
    if (~ $pkg *..* */*) {
        echo bad name $pkg >>fail/ERROR
    } else {
        echo .. package $pkg
        fail=0
        cran2deb build $pkg >fail/$pkg >[2=1] || fail=1
        if (~ $fail 0) {
            grep '^[WE]:' fail/$pkg >warn/$pkg
            if (~ `{stat -c '%s' warn/$pkg} 0) {
                rm -f warn/$pkg
            }
            rm -f fail/$pkg
        }
    }
}
